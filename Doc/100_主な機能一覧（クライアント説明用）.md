# つくばホワイト歯科 × ハブラーシカ LINEミニアプリ - 主な機能一覧

**クライアント説明用資料**

---

## 1. デジタル診察券機能

患者様のスマートフォンに、いつでも持ち歩けるデジタル診察券を提供します。

### 主な機能
- **診察券番号の表示**: QRコード形式 + テキスト表示で、受付での確認がスムーズに
- **診察券番号のコピー**: ワンタップで番号をコピー、オンライン予約時に便利
- **患者情報の自動保存**: LINEプロフィールと連携し、初回ログイン時に自動登録
- **最終来院日の表示**: 前回の来院日を自動記録・表示

### 患者様のメリット
- 紙の診察券を持ち歩く必要がなくなります
- 診察券を紛失する心配がありません
- LINEから直接アクセスできるので利便性が向上します

---

## 2. 来院スタンプ機能

来院するたびにスタンプが貯まる、楽しく通院を続けられる仕組みです。

### 主な機能
- **QRコード読み取り**: 受付に設置されたQRコードをスキャンしてスタンプ獲得
- **スタンプカウンター**: 現在のスタンプ数をリアルタイム表示
- **来院履歴の記録**: 来院日時とスタンプ数を自動記録
- **プログレスバー**: 次の特典まであと何個かが一目でわかる
- **スタッフ手動付与機能**: QRコードが読み取れない場合に備えた手動スタンプ機能（暗証番号保護）

### スタンプ獲得方法

**QRコードスキャン:**
- 院内に設置されたQRコードをLINEアプリでスキャン
- 通常患者様用：5個のスタンプ
- 優良患者様用：10個のスタンプ
- 1日1回のみスキャン可能（重複防止）

**スタッフ手動付与:**
- QRコードが読み取れない場合の対応
- 暗証番号（1234）で保護
- スタンプ数の増減が可能

**アンケート回答報酬:**
- 患者満足度アンケート等に回答すると30個のスタンプを付与
- アンケートごとに1回のみ回答可能（重複防止）
- 回答報酬は来院回数にカウントされません

**スロットゲーム:**
- 子供用モードで楽しめるミニゲーム
- 3〜8個のスタンプを追加付与

### 運用上のポイント
- QRコードスキャン：通常5個、優良10個を自動付与
- 同日の重複スキャン防止機能付き
- スタッフが手動で修正可能（誤登録時の対応）
- すべての操作履歴をデータベースに記録（監査証跡）
- テスト用削除機能：スタッフモーダルから本日のQRスキャンを削除可能

### 患者様のメリット
- 通院が楽しくなり、定期検診の継続率が向上します
- 自分の通院実績が可視化されます
- スタンプを貯める達成感が得られます
- スマートフォンで簡単にQRコードをスキャンできます

---

## 3. 特典交換システム（積み上げ式）

貯まったスタンプで豪華な特典と交換できる、患者様のモチベーション向上施策です。

### 主な機能
- **特典一覧の表示**: 交換可能な特典をカード形式で表示
- **交換可否の自動判定**: 現在のスタンプ数で交換できるかリアルタイム判定
- **積み上げ式システム**: 交換後もスタンプは減らず、何度でも交換可能
- **交換履歴の管理**: 誰がいつ何を交換したかを記録（ステータス管理: 申請中/提供完了/キャンセル）

### 初期特典ラインナップ
| 必要スタンプ | 特典内容 | 詳細 |
|------------|---------|------|
| 50個 | オリジナル歯ブラシセット | 歯ブラシ + 歯磨き粉 |
| 100個 | フッ素塗布1回無料券 | 通常1,100円 → 無料（有効期限6ヶ月） |
| 150個 | 歯のクリーニング50%OFF券 | 通常5,500円 → 2,750円（有効期限3ヶ月） |
| 200個 | ホワイトニング1回30%OFF券 | 通常16,500円 → 11,550円（有効期限3ヶ月） |

### 「積み上げ式」とは
従来型のポイント消費型（スタンプを使うと減る）ではなく、**スタンプは常に累積**されます。

**例**: 200個貯まったら、50個/100個/150個/200個の特典すべてを交換できます。

### 運用上のポイント
- 特典内容は管理画面から自由に追加・変更可能
- 在庫管理機能（将来実装予定）
- 交換申請を受けた後、受付で実際の特典を提供してから「提供完了」に変更

### 患者様のメリット
- 通院を続けるほどお得になります
- 予防歯科の継続的な受診が促進されます
- 高額な自費診療（ホワイトニング等）へのハードルが下がります

---

## 4. 次回メモ機能

受付スタッフが各患者様に対して、次回来院予定日やパーソナライズされたメッセージを設定できる機能です。

### 主な機能
- **次回来院予定日の設定**: カレンダーから日付を選択
- **カスタムメッセージの設定**: 患者様ごとに200文字以内のメッセージを作成
- **リアルタイム反映**: 設定後すぐに患者様のLINEミニアプリに表示
- **デフォルトメッセージ**: 未設定時は自動的に「次回のご来院をお待ちしております。毎日の歯磨き、頑張りましょう！」を表示

### 表示パターン
患者様のホーム画面（ハブラーシカメッセージ）に以下の形式で表示されます：

| パターン | 表示内容 |
|---------|---------|
| 日付あり + メモあり | 「次回の定期検診は2026年4月13日です。<br>お疲れ様です！今日も歯のケア、一緒に頑張りましょう。」 |
| 日付あり + メモなし | 「次回の定期検診は2026年4月13日です。」 |
| 日付なし + メモあり | 「お疲れ様です！今日も歯のケア、一緒に頑張りましょう。」 |
| どちらもなし | 「次回のご来院をお待ちしております。毎日の歯磨き、頑張りましょう！」（デフォルト） |

### 運用フロー
```
診察終了 → 次回予約確認 → 管理画面でユーザーIDを入力
→ 次回来院日を設定 → 必要に応じてメッセージ入力
→ 保存 → 患者様のLINEミニアプリに即座に反映
```

### ユーザーID取得方法
患者様の名前や診察券番号でSupabaseデータベースを検索して、LINE User IDを取得します。

```sql
-- 例: 患者名で検索
SELECT id, display_name, ticket_number, stamp_count
FROM profiles
WHERE display_name LIKE '%横山%';
```

### 院内での活用例
- 「次回は3ヶ月後の定期検診です。お待ちしております！」
- 「前回お話しした詰め物の調子はいかがですか？」
- 「ホワイトニングのご相談、お気軽にどうぞ！」
- 「お子様の歯並びチェック、次回も楽しみにしていますね」

### 患者様のメリット
- 次回の予約日を忘れにくくなります
- パーソナライズされたメッセージで、院との距離が近く感じられます
- 定期検診のリマインダーとして機能します

### 医院側のメリット
- 患者様ごとにカスタマイズしたコミュニケーションが可能
- 再来院率の向上が期待できます
- 予約の失念による無断キャンセルを減らせます

---

## 5. アンケート機能

患者様の声を集めてサービス改善につなげるアンケート機能です。

### 主な機能
- **満足度調査**: 患者様の満足度を5段階評価で収集
- **自由記入欄**: 改善提案やご意見を自由に記入可能
- **回答報酬**: アンケートに回答するとスタンプ30個をプレゼント
- **重複回答防止**: 同じアンケートには1回のみ回答可能
- **回答データの記録**: すべての回答をデータベースに保存・分析可能

### アンケート表示条件
- 回答期間中のアンケートを自動表示（is_active = true）
- すでに回答済みの場合は表示されません
- モーダル形式で表示され、「後で回答」も選択可能

### 質問項目（初期設定例）
1. **総合的な満足度**: 5段階評価（とても満足〜不満）
2. **スタッフの対応**: 5段階評価
3. **待ち時間**: 5段階評価
4. **施設の清潔さ**: 5段階評価
5. **治療の説明**: 5段階評価
6. **自由記入欄**: 200文字まで

### データベース構造
- **surveys テーブル**: アンケート定義（タイトル、説明、報酬スタンプ数、期間）
- **survey_questions テーブル**: 質問項目（質問文、回答形式、順序）
- **survey_responses テーブル**: 回答データ（ユーザーID、回答内容、回答日時）

### 運用上のポイント
- アンケート報酬は来院回数にカウントされません（`stamp_method: 'survey_reward'`）
- 回答データは管理ダッシュボードから確認可能（将来実装予定）
- アンケート期間は自由に設定可能（例: 2026年2月26日〜3月31日）
- 報酬スタンプ数も柔軟に設定可能（デフォルト: 30個）

### 医院側のメリット
- 患者様の満足度を定量的に把握できます
- 改善点を具体的に発見できます
- サービス品質の継続的な向上につながります
- アンケート回答率の向上（スタンプ報酬で動機付け）

### 患者様のメリット
- 自分の声を医院に届けられます
- スタンプがもらえるのでお得です
- より良いサービス改善に貢献できます

---

## 6. オンライン予約連携（アポツール）

既存の予約システム「アポツール」とスムーズに連携します。

### 主な機能
- **診察券番号の自動コピー**: 予約ボタンをタップすると診察券番号が自動コピーされます
- **アポツールへの直接遷移**: LINEミニアプリから新しいタブでアポツールが開きます
- **診察券番号の貼り付け**: コピーされた番号を予約フォームに簡単に貼り付けられます

### 患者様のメリット
- 診察券番号を手入力する手間が省けます
- LINEから直接予約サイトにアクセスできます
- 予約がよりスムーズになります

---

## 7. LINE公式アカウント友だち登録促進

公式LINE（@550mlcao）への友だち登録を促進し、より深いエンゲージメントを実現します。

### 主な機能
- **友だち登録状態の自動チェック**: LINEミニアプリ起動時に自動判定
- **登録促進モーダル**: 未登録の場合、初回起動時にモーダル表示（1日1回）
- **医院情報ページでの案内**: 常に友だち登録ボタンを表示（未登録の場合）
- **登録状況のデータベース管理**: Supabaseで友だち登録状況を記録

### 医院側のメリット
- 友だち登録率を向上させます
- 患者様との継続的なコミュニケーションチャネルを確保できます
- キャンペーン情報や重要なお知らせを配信できます
- 友だち登録率の統計分析が可能です

---

## 8. 医院情報表示

患者様が必要な情報にいつでもアクセスできます。

### 主な機能
- **診療時間・アクセス情報**: 住所、電話番号、診療時間を表示
- **院長・スタッフ紹介**: 医院の雰囲気を伝えます
- **公式LINEへの導線**: 友だち登録ボタン
- **設定ページへのリンク**: 表示モード切替（大人用/子供用）

### 患者様のメリット
- 診療時間や連絡先をいつでも確認できます
- 医院の雰囲気が事前にわかり安心感があります

---

## 9. 子供用モード（将来実装予定）

お子様が楽しく使えるキッズモードを準備中です。

### 計画中の機能
- **ひらがな表記**: お子様でも読みやすい表示
- **カラフルなデザイン**: 明るいピンク・イエロー・グリーン等のキッズカラー
- **ハブラーシカのキャラクター**: かわいいキャラクターでお子様の興味を引きます
- **スロットゲーム**: 歯磨き習慣を楽しく続けられるゲーム要素
- **M PLUS Rounded 1c フォント**: やさしく丸みのあるフォント

---

## 10. セキュリティ・プライバシー保護

患者様の個人情報を厳重に保護します。

### セキュリティ対策
- **LINE認証**: LINE公式の認証システムを使用
- **Supabase Row Level Security**: データベースレベルでのアクセス制御
- **暗証番号保護**: スタッフ操作は暗証番号で保護
- **監査証跡**: すべての重要操作を記録
- **環境変数管理**: 機密情報は環境変数で安全に管理

---

## 11. 管理・運用機能

受付スタッフが日常業務で使用する機能です。

### 現在利用可能な機能
- **スタッフ手動スタンプ機能**: QRコードが読み取れない時の対応（暗証番号: 1234）
- **本日のQRスキャン削除機能**: テスト用（スタッフモーダル内）
- **次回メモ管理画面**: 患者様ごとの次回来院日・メッセージ設定（/admin/memo）
- **Supabaseダッシュボード**: データベースの直接確認・編集

### 将来実装予定の機能
- **本格的な管理ダッシュボード**: 患者管理、統計分析、通知管理等
- **患者検索機能**: 名前や診察券番号で患者様を検索
- **統計・分析機能**: 来院数、スタンプ達成率等の可視化
- **特典在庫管理**: 交換可能特典の在庫状況管理
- **メッセージテンプレート**: よく使うメッセージの登録

---

## 技術スタック

### フロントエンド
- **Next.js 16**: 最新のReactフレームワーク
- **TypeScript**: 型安全な開発
- **Tailwind CSS**: モダンなUIデザイン
- **LINE LIFF SDK**: LINE連携

### バックエンド
- **Supabase**: PostgreSQLデータベース + 認証 + ストレージ
- **Next.js API Routes**: サーバーレス関数
- **Vercel**: ホスティング環境

### セキュリティ
- **Row Level Security (RLS)**: Supabaseのデータベースレベルセキュリティ
- **環境変数管理**: 機密情報の安全な管理
- **LINE公式認証**: 信頼性の高い認証システム

---

## 今後の展開予定

### Phase 6: LINE Messaging API連携
- **定期検診リマインド**: 前回来院から3ヶ月後に自動通知
- **予約リマインド**: 予約日の1週間前に確認メッセージ
- **特典交換通知**: 特典交換可能になったらお知らせ
- **ハブラーシカからの励まし**: パーソナライズされたメッセージ配信

### Phase 7: 本格的な管理ダッシュボード
- **患者管理**: 一覧表示、検索、詳細閲覧
- **統計・分析**: 来院数、アクティブユーザー、スタンプ達成率
- **通知管理**: 一斉配信、個別メッセージ送信
- **特典管理**: 特典の追加・編集・在庫管理

### Phase 8: 高度な機能
- **予約システム統合**: オンライン予約機能の内製化
- **診療履歴閲覧**: 治療内容の記録閲覧
- **AIアドバイス**: 口腔ケアのパーソナルガイド

### Phase 3: ケア記録機能
- **デイリーチェックリスト**: フロス、マウスウォッシュ、歯磨き時間
- **セルフケアカレンダー**: 習慣の可視化
- **ハブラーシカからの励まし**: ケア記録に基づくアドバイス

---

## お問い合わせ

本機能一覧に関するご質問やご要望は、開発チームまでお気軽にお問い合わせください。

---

**最終更新日**: 2026年2月27日
**バージョン**: 1.2.0
