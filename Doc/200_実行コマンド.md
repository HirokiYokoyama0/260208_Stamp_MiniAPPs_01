# å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

**æœ€çµ‚æ›´æ–°**: 2026-02-22

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã§ä½¿ç”¨ã™ã‚‹ä¸»è¦ãªã‚³ãƒãƒ³ãƒ‰ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

---

## ğŸš€ ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã®èµ·å‹•

### 1. Next.js é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
npm run dev
```

- **ãƒãƒ¼ãƒˆ**: `4000`
- **URL**: http://localhost:4000
- **èª¬æ˜**: Next.js ã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰æœ‰åŠ¹ï¼‰

### 2. ngrok ã§ãƒˆãƒ³ãƒãƒ«æ¥ç¶š

**åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œ**:

```bash
npx ngrok http 4000
```

- **ãƒãƒ¼ãƒˆ**: `4000` (Next.js ã‚µãƒ¼ãƒãƒ¼ã¨åŒã˜)
- **èª¬æ˜**: ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã—ã¾ã™ï¼ˆLIFFé–‹ç™ºç”¨ï¼‰
- **å‡ºåŠ›ä¾‹**:
  ```
  Forwarding  https://xxxx-yyyy-zzzz.ngrok-free.app -> http://localhost:4000
  ```
- **æ³¨æ„**: ngrok ã® URL ã‚’ LIFF ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ URL ã¨ã—ã¦ LINE Developers ã«è¨­å®š

### ğŸ“‹ ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã®å®Œå…¨èµ·å‹•æ‰‹é †

```bash
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1: Next.js ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev

# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2: ngrok ãƒˆãƒ³ãƒãƒ«èµ·å‹•
npx ngrok http 4000
```

**ç¢ºèª**:
1. ngrok ã®å‡ºåŠ›ã‹ã‚‰ `https://xxxx.ngrok-free.app` ã‚’ã‚³ãƒ”ãƒ¼
2. LINE Developers > LIFF > ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ URL ã«è¨­å®š
3. LINE ã‚¢ãƒ—ãƒªã‹ã‚‰ LIFF ã‚’é–‹ã„ã¦å‹•ä½œç¢ºèª

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå…¨ä½“ç¢ºèª

```bash
npx tsx test/check-all-schema.ts
```

**ç¢ºèªé …ç›®**:
1. profiles ãƒ†ãƒ¼ãƒ–ãƒ«
2. stamp_history ãƒ†ãƒ¼ãƒ–ãƒ«
3. families ãƒ†ãƒ¼ãƒ–ãƒ«
4. family_stamp_totals ãƒ“ãƒ¥ãƒ¼
5. rewards ãƒ†ãƒ¼ãƒ–ãƒ«
6. reward_exchanges ãƒ†ãƒ¼ãƒ–ãƒ«
7. å¤–éƒ¨ã‚­ãƒ¼æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
8. Phase 1: 10å€æ•´æ•°ã‚·ã‚¹ãƒ†ãƒ  (visit_count, amount)
9. stamp_history.amount ã‚«ãƒ©ãƒ 
10. Phase 2.5: real_name & ticket_number ã‚«ãƒ©ãƒ 

**æ¨å¥¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°**:
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå¾Œ
- æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‰
- ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãŒç–‘ã‚ã—ã„å ´åˆ

### å€‹åˆ¥ã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
# å®¶æ—æ©Ÿèƒ½ã®ç¢ºèª
npx tsx test/check-families-schema.ts

# view_mode ã®ç¢ºèª
node test/check-viewmode.mjs

# å®¶æ—ã‚¹ã‚¿ãƒ³ãƒ—åˆè¨ˆã®ç¢ºèª
node test/check-family-stamps.mjs

# Supabase æ¥ç¶šãƒ†ã‚¹ãƒˆ
npx tsx test/supabase-connection.ts
```

### TypeScript å‹ãƒã‚§ãƒƒã‚¯

```bash
npx tsc --noEmit
```

- ã‚¨ãƒ©ãƒ¼ãŒãªã‘ã‚Œã°å‹å®šç¾©ã¯æ­£å¸¸

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### Supabase SQL Editor ã§å®Ÿè¡Œ

1. Supabase Dashboard ã«ãƒ­ã‚°ã‚¤ãƒ³
2. SQL Editor ã‚’é–‹ã
3. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ
4. å®Ÿè¡Œ

**ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œé †åº**:

```sql
-- 1. profiles ãƒ†ãƒ¼ãƒ–ãƒ« (Phase 0)
supabase/001_create_profiles_table.sql

-- 2. stamp_history ãƒ†ãƒ¼ãƒ–ãƒ« (Phase 0)
supabase/002_create_stamp_history_table.sql

-- 3. rewards ãƒ†ãƒ¼ãƒ–ãƒ« (Phase 0)
supabase/003_create_rewards_tables.sql

-- 4. is_line_friend ã‚«ãƒ©ãƒ  (Phase 0)
supabase/004_add_is_line_friend_column.sql

-- 5. view_mode ã‚«ãƒ©ãƒ  (Phase 0)
supabase/005_add_view_mode_column.sql

-- 6. next_memo ã‚«ãƒ©ãƒ  (Phase 0)
supabase/006_add_next_memo_columns.sql

-- 7. reservation_button_clicks ã‚«ãƒ©ãƒ  (Phase 0)
supabase/007_add_reservation_clicks.sql

-- 8. 10å€æ•´æ•°ã‚·ã‚¹ãƒ†ãƒ  (Phase 1)
supabase/008_add_10x_system_columns.sql

-- 9. å®¶æ—æ©Ÿèƒ½ (Phase 2)
supabase/009_add_family_support.sql

-- 10. RLS ãƒãƒªã‚·ãƒ¼ä¿®æ­£ (Phase 2)
supabase/009_fix_rls_policies.sql

-- 11. ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ (Phase 2)
supabase/010_add_integrity_check.sql

-- 12. line_user_id NULL è¨±å¯ (Phase 2)
supabase/011_allow_null_line_user_id.sql

-- 13. real_name ã‚«ãƒ©ãƒ  (Phase 2.5)
supabase/012_add_real_name_column.sql
```

**å®Ÿè¡Œå¾Œã®ç¢ºèª**:

```bash
npx tsx test/check-all-schema.ts
```

---

## ğŸ“¦ ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤

### ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰ç¢ºèª

```bash
npm run build
```

- **èª¬æ˜**: æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã‚’ç”Ÿæˆï¼ˆã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ï¼‰
- **æ³¨æ„**: ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã®æ›´æ–°

```bash
npm run version:update
```

- **èª¬æ˜**: `package.json` ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›´æ–°
- **è‡ªå‹•å®Ÿè¡Œ**: `npm run build` å®Ÿè¡Œæ™‚ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹ï¼ˆprebuild ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰

### Vercel ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
git add .
git commit -m "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
git push origin main
```

- **èª¬æ˜**: main ãƒ–ãƒ©ãƒ³ãƒã« push ã™ã‚‹ã¨ Vercel ãŒè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- **ç¢ºèª**: Vercel Dashboard ã§ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³ã‚’ç¢ºèª

---

## ğŸ› ï¸ ãã®ä»–ã®ä¾¿åˆ©ã‚³ãƒãƒ³ãƒ‰

### ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç† (Windows)

```bash
# ãƒãƒ¼ãƒˆ 4000 ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
netstat -ano | findstr :4000

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¼·åˆ¶çµ‚äº† (PID ã‚’ç¢ºèªã—ã¦ã‹ã‚‰å®Ÿè¡Œ)
taskkill /PID <ãƒ—ãƒ­ã‚»ã‚¹ID> /F

# Git Bashã§ taskkill ãŒå‹•ä½œã—ãªã„å ´åˆ
cmd /c "taskkill /PID <ãƒ—ãƒ­ã‚»ã‚¹ID> /F"

# PowerShell ã§ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†
powershell -Command "Stop-Process -Id <ãƒ—ãƒ­ã‚»ã‚¹ID> -Force"

# Node.js ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§
tasklist | findstr node

# å®Ÿè¡Œä¾‹: ãƒãƒ¼ãƒˆ4000ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹3500ã‚’çµ‚äº†
netstat -ano | findstr :4000
# â†’ PID 3500 ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆ
cmd /c "taskkill /PID 3500 /F"
```

### ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª

```bash
# .env.local ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
node -e "require('dotenv').config({path:'.env.local'}); console.log(process.env.NEXT_PUBLIC_SUPABASE_URL)"
```

### Git æ“ä½œ

```bash
# å¤‰æ›´çŠ¶æ³ç¢ºèª
git status

# å·®åˆ†ç¢ºèª
git diff

# ãƒ–ãƒ©ãƒ³ãƒç¢ºèª
git branch

# ã‚³ãƒŸãƒƒãƒˆå±¥æ­´
git log --oneline -10
```

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [03_æ©Ÿèƒ½ä»•æ§˜æ›¸.md](03_æ©Ÿèƒ½ä»•æ§˜æ›¸.md) - å„æ©Ÿèƒ½ã®è©³ç´°ä»•æ§˜
- [05_Database_Schema.md](05_Database_Schema.md) - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ
- [10_TODO.md](10_TODO.md) - ã‚¿ã‚¹ã‚¯ç®¡ç†
- [90_å®Ÿè£…å±¥æ­´.md](90_å®Ÿè£…å±¥æ­´.md) - æ—¥æ¬¡ã®å®Ÿè£…å†…å®¹
- [Implementation_Log_mio.md](Implementation_Log_mio.md) - è©³ç´°ãªå®Ÿè£…ãƒ­ã‚°

---

## âš ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒãƒ¼ãƒˆ 4000 ãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹

```bash
# Windows
netstat -ano | findstr :4000
taskkill /PID <ãƒ—ãƒ­ã‚»ã‚¹ID> /F

# ã¾ãŸã¯åˆ¥ã®ãƒãƒ¼ãƒˆã§èµ·å‹•
npm run dev -- -p 4001
npx ngrok http 4001
```

### ngrok ãŒèµ·å‹•ã—ãªã„

```bash
# ngrok ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
npx ngrok version

# ngrok ã®èªè¨¼ï¼ˆåˆå›ã®ã¿ï¼‰
npx ngrok authtoken <YOUR_AUTH_TOKEN>
```

### Supabase æ¥ç¶šã‚¨ãƒ©ãƒ¼

```bash
# ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèª
cat .env.local

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npx tsx test/supabase-connection.ts
```

---

**ä½œæˆè€…**: Claude Code
**æœ€çµ‚æ›´æ–°æ—¥**: 2026-02-22
