# スマホなし子ども画面開発者が守るべきこと

**作成日:** 2026-02-27
**対象:** スマホなし子ども画面の担当開発者
**重要度:** ★★★★★ 必読

---

## 🚨 開発前に必ず読んでください（超重要）

### ルール1: mainブランチへの直接pushは絶対禁止 🚫

```bash
# ❌ 絶対にやってはいけないこと
git checkout main
git push origin main

# ✅ 必ずやること
git checkout -b feature/kids-screen    # 専用ブランチを作成
git push origin feature/kids-screen    # 専用ブランチにpush
# → GitHub上でPull Requestを作成
# → ソラシドワークス様がレビュー・承認
# → 承認後にmainへマージ
```

**なぜ重要か:**
- mainブランチは本番環境に直結しています
- あなたの変更が既存の大人用画面を壊す可能性があります
- Pull Requestで「変な書き換えがないか」を必ず検品します

### ルール2: 共通ロジック（lib/hooks/）の変更は必ず相談 ⚠️

```typescript
// ❌ 絶対にやってはいけないこと
// lib/stamps.ts の既存関数を変更
export const fetchStampCount = async (userId: string) => {
  // 「使いにくいから」と勝手に変更 ← これで大人用画面が壊れる！
}

// ✅ やるべきこと
// 新しい関数を追加する
export const fetchChildStampCount = async (childId: string) => {
  // 子ども画面専用の新しい関数
}

// または、変更が必要な場合は必ずメイン担当者に相談
```

**なぜ重要か:**
- `lib/` や `hooks/` の関数は、大人用画面・子ども用モード・API全体で共有されています
- 1つの関数を変更すると、アプリ全体が壊れる可能性があります
- 「使いにくい」と感じても、必ず相談してから変更してください

### ルール3: データベーススキーマの変更は絶対に相談 🔒

```sql
-- ❌ 絶対にやってはいけないこと
CREATE TABLE child_settings (...);
ALTER TABLE profiles ADD COLUMN ...;

-- ✅ やるべきこと
-- メイン担当者に相談して、必要性を確認
-- → 担当者がマイグレーションファイルを作成
```

**なぜ重要か:**
- データベースは全ユーザーで共有されています
- 誤った変更は本番環境のデータを壊す可能性があります
- マイグレーションは慎重に行う必要があります

---

## ⚠️ 最重要：触ってはいけないファイル

以下のファイル・フォルダは**絶対に編集禁止**です：

```
❌ components/(adult)/          # 大人用画面（触らない）
❌ app/api/                    # 既存API（変更する場合は要相談）
❌ lib/                        # 共通ライブラリ（変更する場合は要相談）
❌ supabase/                   # データベースマイグレーション（触らない）
❌ contexts/                   # 共通Context（触らない）
❌ hooks/                      # 共通hooks（触らない）
❌ types/                      # 型定義（変更する場合は要相談）
```

---

## ✅ 自由に編集できるフォルダ・ファイル

### 1. app/child-mode/ （メイン開発対象）

```
app/
└── child-mode/
    ├── page.tsx              ✅ スマホなし子ども用ホーム画面
    └── settings/
        └── page.tsx          ✅ スマホなし子ども用設定画面
```

**編集内容:**
- レイアウト変更
- デザイン調整
- 新機能追加
- ロジック修正

**注意点:**
- このフォルダ内のファイルは完全に独立しているため、自由に編集可能
- ただし、`/api/profiles/[profileId]` などのAPIは既存のものを使用

---

### 2. components/(kids)/ （子ども用コンポーネント）

```
components/
└── (kids)/
    ├── KidsHome.tsx          ⚠️ 要注意（後述）
    ├── KidsStampPage.tsx     ✅ 自由に編集可能（現在プレースホルダー）
    ├── KidsRewardsPage.tsx   ✅ 自由に編集可能（現在プレースホルダー）
    ├── KidsCarePage.tsx      ✅ 自由に編集可能（現在プレースホルダー）
    └── KidsInfoPage.tsx      ✅ 自由に編集可能（現在プレースホルダー）
```

#### ✅ 完全に自由に編集できるファイル

以下の4つは**現在プレースホルダー**なので、ゼロから開発してOK：

- `KidsStampPage.tsx` - スタンプページ
- `KidsRewardsPage.tsx` - 特典ページ
- `KidsCarePage.tsx` - ケア記録ページ
- `KidsInfoPage.tsx` - 医院情報ページ

#### ⚠️ 要注意：KidsHome.tsx

**重要:** このファイルは**2つの場所で使用**されています：

1. **通常の子ども用モード**: 親が自分のスマホで子どもモードに切り替えた時
2. **スマホなし子ども画面**: 親が管理する仮想メンバー（スマホを持っていない子ども）

**編集する場合のルール:**

```typescript
// ✅ OK: 新しいpropsを追加
interface KidsHomeProps {
  profileOverride?: Profile;  // 既存
  newFeature?: boolean;       // 追加OK
}

// ✅ OK: 新しいstateを追加
const [newState, setNewState] = useState(false);

// ⚠️ 要注意: profileOverride の扱いを変更する場合
// → 必ずメイン担当者に確認すること

// ❌ NG: profileOverride を削除
// → 2つのモードで動かなくなる
```

**変更前に必ず確認:**
- `profileOverride` プロパティの動作に影響があるか？
- 両方のモードで正しく動作するか？

---

## 📁 フォルダ構成の全体像

### あなたが開発する部分（青枠内）

```
260208_Stamp_MiniAPPs_01/
│
├── app/
│   ├── child-mode/              ← 🎯 ここを開発
│   │   ├── page.tsx
│   │   └── settings/
│   │       └── page.tsx
│   │
│   ├── api/                     ← ❌ 触らない（既存APIを使用）
│   ├── page.tsx                 ← ❌ 触らない（ルートページ）
│   ├── stamp/page.tsx           ← ❌ 触らない（大人用）
│   └── ...
│
├── components/
│   ├── (kids)/                  ← 🎯 ここを開発
│   │   ├── KidsHome.tsx         ← ⚠️ 要注意（変更する場合は要相談）
│   │   ├── KidsStampPage.tsx    ← ✅ 自由に開発
│   │   ├── KidsRewardsPage.tsx  ← ✅ 自由に開発
│   │   ├── KidsCarePage.tsx     ← ✅ 自由に開発
│   │   └── KidsInfoPage.tsx     ← ✅ 自由に開発
│   │
│   ├── (adult)/                 ← ❌ 触らない（大人用画面）
│   ├── layout/                  ← ❌ 触らない（共通レイアウト）
│   └── ...
│
├── lib/                         ← ❌ 触らない（既存の関数を使用）
├── hooks/                       ← ❌ 触らない（既存のhooksを使用）
├── contexts/                    ← ❌ 触らない
├── types/                       ← ❌ 触らない（既存の型を使用）
├── supabase/                    ← ❌ 触らない
└── public/                      ← ✅ 画像追加は可能
```

---

## 🔧 既存の機能を使用する方法

### データ取得（API呼び出し）

**既存のAPIを使用してください：**

```typescript
// ✅ OK: 既存のAPIエンドポイントを使用
const res = await fetch(`/api/profiles/${childId}`);
const data = await res.json();

// ✅ OK: 既存の関数を使用
import { fetchStampCount, fetchStampHistory } from '@/lib/stamps';
const count = await fetchStampCount(userId);

// ❌ NG: 新しいAPIエンドポイントを勝手に作成
// → 必要な場合はメイン担当者に相談
```

### Supabaseクライアント

**既存のクライアントを使用：**

```typescript
// ✅ OK: 既存のSupabaseクライアントをインポート
import { supabase } from '@/lib/supabase';

// データ取得
const { data, error } = await supabase
  .from('profiles')
  .select('*')
  .eq('id', userId)
  .single();

// ❌ NG: 新しいSupabaseクライアントを作成
// ❌ NG: 環境変数を直接使用
```

### 型定義

**既存の型定義を使用：**

```typescript
// ✅ OK: 既存の型をインポート
import { StampHistoryRecord } from '@/types/stamp';

// ✅ OK: 新しい型を定義（子ども画面専用）
interface ChildModeState {
  isLoading: boolean;
  profile: Profile | null;
}

// ⚠️ 要注意: 既存の型を変更する場合
// → 必ずメイン担当者に確認
```

---

## 🚀 開発の流れ

### 1. ブランチを作成

```bash
# メインから最新を取得
git checkout main
git pull origin main

# 開発用ブランチを作成
git checkout -b feature/child-mode-ui
```

### 2. 開発・テスト

```bash
# 開発サーバー起動
npm run dev

# ブラウザで確認
# http://localhost:3000/child-mode
```

### 3. コミット

```bash
# 変更をステージング（child-mode関連のみ）
git add app/child-mode/
git add components/(kids)/

# コミット（必ずプレフィックスを付ける）
git commit -m "feat(child-mode): スロットゲーム画面を追加"
```

### 4. Push & Pull Request

```bash
# リモートにpush
git push origin feature/child-mode-ui

# GitHub上でPull Requestを作成
# → メイン担当者がレビュー
```

---

## ⚙️ Git運用ルール

### コミットメッセージの規則

**必ず `(child-mode)` を付ける：**

```bash
# ✅ 良い例
git commit -m "feat(child-mode): スロットゲーム画面を追加"
git commit -m "fix(child-mode): スタンプ表示のバグ修正"
git commit -m "style(child-mode): 背景色を調整"
git commit -m "refactor(child-mode): コンポーネント構造を改善"

# ❌ 悪い例（どこを変更したか不明）
git commit -m "画面を追加"
git commit -m "バグ修正"
git commit -m "デザイン調整"
```

### プレフィックスの種類

| プレフィックス | 意味 | 例 |
|-------------|------|---|
| `feat` | 新機能追加 | `feat(child-mode): スロットゲーム追加` |
| `fix` | バグ修正 | `fix(child-mode): 表示崩れを修正` |
| `style` | デザイン変更 | `style(child-mode): 背景色変更` |
| `refactor` | リファクタリング | `refactor(child-mode): コード整理` |
| `docs` | ドキュメント | `docs(child-mode): README更新` |

### こまめにコミット

```bash
# ✅ 良い例: 小さな単位でコミット
git commit -m "feat(child-mode): ヘッダーコンポーネント追加"
git commit -m "feat(child-mode): スタンプカード表示機能追加"
git commit -m "style(child-mode): ボタンのデザイン調整"

# ❌ 悪い例: まとめてコミット（レビューしづらい）
git commit -m "feat(child-mode): 全機能を実装"
```

---

## 🧪 テスト手順

### ローカル環境でのテスト

1. **家族管理画面で子どもを追加:**
```
http://localhost:3000/family/manage
→ 「子どもを追加」ボタン
→ 名前: "テスト太郎"
→ 診察券番号: "12345678"
```

2. **子ども画面に遷移:**
```
子どものカードをタップ
→ http://localhost:3000/child-mode に遷移
```

3. **動作確認項目:**
- [ ] 子どもの名前が表示される
- [ ] 診察券番号が表示される
- [ ] スタンプ数が表示される
- [ ] 戻るボタンが機能する
- [ ] デザインが子ども向けになっている

### Vercelプレビュー環境でのテスト

```bash
# pushすると自動でプレビュー環境が作成される
git push origin feature/child-mode-ui

# Vercelダッシュボードでプレビュー環境のURLを確認
# → そのURLでテスト
```

---

## ❗ 絶対にやってはいけないこと

### 1. 既存機能の破壊

```typescript
// ❌ NG: 既存の関数を変更
export const fetchStampCount = async (userId: string) => {
  // 変更...
}

// ✅ OK: 新しい関数を追加
export const fetchChildStampCount = async (childId: string) => {
  // 新機能...
}
```

### 2. データベーススキーマの変更

```sql
-- ❌ NG: 勝手にテーブルを作成
CREATE TABLE child_mode_settings (...);

-- ❌ NG: 既存テーブルにカラムを追加
ALTER TABLE profiles ADD COLUMN ...;
```

**必要な場合は必ずメイン担当者に相談！**

### 3. 環境変数の変更

```bash
# ❌ NG: 新しい環境変数を追加
NEXT_PUBLIC_NEW_FEATURE=...

# ❌ NG: 既存の環境変数を変更
NEXT_PUBLIC_LIFF_ID=...
```

**必要な場合は必ずメイン担当者に依頼！**

### 4. 依存関係の追加

```bash
# ❌ NG: 勝手にライブラリをインストール
npm install some-library

# ✅ OK: 必要な場合はメイン担当者に相談
# → 担当者が判断してインストール
```

### 5. mainブランチへの直接push

```bash
# ❌ NG: mainブランチに直接push
git checkout main
git push origin main

# ✅ OK: feature ブランチからPull Request
git checkout feature/child-mode-ui
git push origin feature/child-mode-ui
# → GitHub上でPull Requestを作成
```

---

## 📞 困ったときの連絡フロー

### すぐに相談が必要なケース

以下の場合は**作業を止めて**メイン担当者に連絡：

1. **既存ファイルの変更が必要そうな場合**
   - 例: `KidsHome.tsx` の大幅な変更
   - 例: API Routesの変更
   - 例: 共通ライブラリの変更

2. **データベース関連**
   - 例: 新しいテーブルが必要
   - 例: 既存テーブルに新しいカラムが必要

3. **ビルドエラーが解決できない場合**
   - エラーメッセージをコピー
   - 再現手順をまとめる
   - メイン担当者に連絡

4. **設計に迷った場合**
   - コンポーネント構造
   - 状態管理の方法
   - データフローの設計

### 連絡方法

```
1. エラーメッセージ or 状況説明
2. 再現手順
3. 試したこと
4. 相談したい内容
```

---

## ✅ チェックリスト

### 開発開始前

- [ ] リポジトリをクローン済み
- [ ] `npm install` 実行済み
- [ ] `.env.local` 設定済み（メイン担当者から受け取る）
- [ ] `npm run dev` で起動確認済み
- [ ] `feature/child-mode-ui` ブランチを作成済み
- [ ] このドキュメントを最後まで読んだ

### コミット前

- [ ] `app/child-mode/` または `components/(kids)/` のみを変更
- [ ] 他のフォルダを触っていない
- [ ] `npm run build` でビルド成功
- [ ] `npx tsc --noEmit` で型エラーなし
- [ ] コミットメッセージに `(child-mode)` を付けた

### Push前

- [ ] ローカルで動作確認済み
- [ ] 不要なファイルをコミットしていない（`.next/`, `node_modules/` など）
- [ ] 最新のmainをマージ済み（競合がない）

### Pull Request前

- [ ] プレビュー環境で動作確認済み
- [ ] 変更内容を説明文に記載
- [ ] スクリーンショットを添付（必要に応じて）
- [ ] メイン担当者にレビュー依頼

---

## 📚 参考ドキュメント

- **[Doc/91_スマホなし子供画面開発ガイド.md](91_スマホなし子供画面開発ガイド.md)**: 詳細な開発ガイド
- **[Doc/04_子供用モード仕様書.md](04_子供用モード仕様書.md)**: 子ども用モードの全体仕様
- **[Doc/70_子供画面切替機能仕様.md](70_子供画面切替機能仕様.md)**: 家族機能とスマホなし子どもの仕様

---

## 🎯 まとめ

### ✅ やること

1. `app/child-mode/` を開発
2. `components/(kids)/` の4つのページコンポーネントを開発
3. こまめにコミット（`feat(child-mode): ...`）
4. プレビュー環境でテスト
5. Pull Request作成

### ❌ やらないこと

1. `components/(adult)/` を触る
2. `app/api/` を変更する
3. `lib/` を変更する
4. `supabase/` を触る
5. mainブランチに直接push

### ⚠️ 迷ったら相談

1. `KidsHome.tsx` を変更する場合
2. データベース関連
3. 既存機能の変更が必要な場合
4. ビルドエラーが解決できない場合

---

**最終更新:** 2026-02-27
**ステータス:** 初版作成完了
**作成者:** メイン開発担当者

**重要:** このドキュメントを守って開発すれば、既存機能との競合は発生しません！
